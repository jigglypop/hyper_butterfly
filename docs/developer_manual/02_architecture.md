# μ‹μ¤ν… μ•„ν‚¤ν…μ²

Reality Stoneμ λ‚΄λ¶€ κµ¬μ΅°μ™€ μ„¤κ³„ μ›μΉ™μ„ μƒμ„Έν μ„¤λ…ν•©λ‹λ‹¤.

## 1. μ „μ²΄ μ•„ν‚¤ν…μ²

```mermaid
graph TD
    subgraph A[Python Layer: μ‚¬μ©μ μΈν„°νμ΄μ¤]
        direction LR
        A1(PyTorch nn.Module) --> A2(torch.autograd)
        A1 --> A3(Rust Binding);
    end
    
    subgraph B[Rust Core: κ³ μ„±λ¥ λ΅μ§]
        direction LR
        B1(PyO3 Interface) --> B2(Hyperbolic/Compressed Logic)
        B2 --> B3(CUDA Dispatcher);
    end

    subgraph C[CUDA Kernel: GPU κ°€μ†]
        direction LR
        C1(Fused Kernels) --> C2(GPU Hardware);
    end

    A3 --> B1;
    B3 --> C1;

    style A fill:#D6EAF8,stroke:#3498DB,color:#000
    style B fill:#D5F5E3,stroke:#2ECC71,color:#000
    style C fill:#FCF3CF,stroke:#F1C40F,color:#000
```

-   **Python Layer**: PyTorchμ™€ μ™„λ²½ν•κ² ν†µν•©λ μ‚¬μ©μ μΉν™”μ  APIλ¥Ό μ κ³µν•©λ‹λ‹¤. `nn.Module`μ„ μƒμ†λ°›μ•„ κΈ°μ΅΄ PyTorch μƒνƒκ³„μ™€ μμ—°μ¤λ½κ² μ—°λ™λ©λ‹λ‹¤.
-   **Rust Core**: λ©”λ¨λ¦¬ μ•μ „μ„±κ³Ό κ³ μ„±λ¥μ„ λ³΄μ¥ν•λ” ν•µμ‹¬ λ΅μ§μ…λ‹λ‹¤. λ¨λ“  ν•μ΄νΌλ³Όλ¦­ μ—°μ‚°κ³Ό μ••μ¶• μ•κ³ λ¦¬μ¦μ΄ κµ¬ν„λμ–΄ μμµλ‹λ‹¤.
-   **CUDA Kernel**: GPU κ°€μ†μ„ μ„ν• μ €μμ¤€ μ»¤λ„μ…λ‹λ‹¤. μ—°μ‚° ν“¨μ „(fused kernel) λ“±μ„ ν†µν•΄ κ·Ήλ„μ μ„±λ¥ μµμ ν™”λ¥Ό μ¶”κµ¬ν•©λ‹λ‹¤.

## 2. Rust μ½”μ–΄ κµ¬μ΅°

### 2.1. λ””λ ‰ν† λ¦¬ κµ¬μ΅° (κ°μ„ μ•)
```
src/
β”β”€β”€ core/                    # ν•µμ‹¬ κ³µν†µ λ¨λ“
β”‚   β”β”€β”€ mod.rs
β”‚   β”β”€β”€ layer.rs            # Layer νΈλ μ΄νΈ
β”‚   β”β”€β”€ tensor.rs           # ν…μ„ μ¶”μƒν™”
β”‚   β”β”€β”€ registry.rs         # λ μ΄μ–΄ λ μ§€μ¤νΈλ¦¬
β”‚   β””β”€β”€ error.rs            # ν†µν•© μ—λ¬ νƒ€μ…
β”β”€β”€ layers/                  # λ μ΄μ–΄ κµ¬ν„
β”‚   β”β”€β”€ hyperbolic/         # ν•μ΄νΌλ³Όλ¦­ λ μ΄μ–΄
β”‚   β””β”€β”€ compressed/         # μ••μ¶• λ μ΄μ–΄
β”β”€β”€ ops/                     # κ³µν†µ μ—°μ‚°
β””β”€β”€ bindings/                # Python λ°”μΈλ”©
```

### 2.2. ν•µμ‹¬ μ„¤κ³„ μ›μΉ™

- **λ©”λ¨λ¦¬ μ•μ „μ„±**: Rustμ μ†μ κ¶ μ‹μ¤ν…μ„ ν†µν•΄ λ©”λ¨λ¦¬ λ„μλ‚ λ°μ΄ν„° κ²½μ(race condition)μ„ μ›μ²μ μΌλ΅ λ°©μ§€ν•©λ‹λ‹¤.
- **μ—λ¬ μ²λ¦¬**: `Result`μ™€ `thiserror`λ¥Ό μ‚¬μ©ν•μ—¬ λ¨λ“  μ μ¬μ  μ‹¤ν¨ κ°€λ¥μ„±μ„ λ…μ‹μ μΌλ΅ μ²λ¦¬ν•©λ‹λ‹¤.
- **μ„±λ¥ μµμ ν™”**: `rayon`μ„ μ΄μ©ν• λ³‘λ ¬ μ²λ¦¬, SIMD μµμ ν™”, μ λ΅ μΉ΄ν”Ό(zero-copy) μ—°μ‚°μ„ ν†µν•΄ μ„±λ¥μ„ κ·Ήλ€ν™”ν•©λ‹λ‹¤.

## 3. Python λ°”μΈλ”© κµ¬μ΅° (κ°μ„ μ•)

### 3.1. ν†µν•© λ°”μΈλ”© μ‹μ¤ν…
`src/bindings/unified.rs` μ™€ λ§¤ν¬λ΅(`macros.rs`)λ¥Ό ν†µν•΄ λ¨λ“  λ μ΄μ–΄μ λ°”μΈλ”©μ„ μλ™ μƒμ„±ν•©λ‹λ‹¤.

```rust
// src/bindings/macros.rs
#[macro_export]
macro_rules! create_py_layer {
    ($name:ident, $rust_type:ty) => {
        // ... PyClass μƒμ„± μ½”λ“ ...
    };
}
```
- **μ¥μ **: μ½”λ“ μ¤‘λ³µ 90% κ°μ†, μƒ λ μ΄μ–΄ μ¶”κ°€ μ©μ΄, μΌκ΄€μ„± μ μ§€

### 3.2. λ°μ΄ν„° ν”λ΅μ°
```
Python (torch.Tensor) β†’ Rust (ndarray) β†’ CUDA Kernel (raw pointer)
β†‘                                                 β†“
Python (torch.Tensor) β† Rust (ndarray) β† CUDA Result (raw pointer)
```
- `PyO3`μ™€ `NumPy` crateλ¥Ό ν†µν•΄ Pythonκ³Ό Rust κ°„μ λ°μ΄ν„° λ³€ν™ μ¤λ²„ν—¤λ“λ¥Ό μµμ†ν™”ν•©λ‹λ‹¤.
- GPU μ‚¬μ© μ‹, `torch.Tensor`μ λ©”λ¨λ¦¬ ν¬μΈν„°λ¥Ό μ§μ ‘ CUDA μ»¤λ„λ΅ μ „λ‹¬ν•μ—¬ λ¶ν•„μ”ν• λ°μ΄ν„° λ³µμ‚¬λ¥Ό λ°©μ§€ν•©λ‹λ‹¤.

## 4. π§ ν…μ¤νΈ μ•„ν‚¤ν…μ² (κ°μ„ μ•)

### 4.1. ν…μ¤νΈ μ „λµ: ν…μ¤νΈ ν”ΌλΌλ―Έλ“
- **λ‹¨μ„ ν…μ¤νΈ (70%)**: Rust(`cargo test`), CUDA(C++ GTest), Python(`pytest`)μ κ° ν•¨μ λ° λ¨λ“μ„ κ°λ³„μ μΌλ΅ ν…μ¤νΈν•©λ‹λ‹¤.
- **ν†µν•© ν…μ¤νΈ (20%)**: Python-Rust-CUDA κ³„μΈµ κ°„μ μ—°λ™, GPU/CPU κ²°κ³Ό μΌκ΄€μ„±, `torch.autograd.gradcheck`λ¥Ό μ΄μ©ν• κ·Έλλ””μ–ΈνΈ μ •ν™•μ„±μ„ κ²€μ¦ν•©λ‹λ‹¤.
- **E2E ν…μ¤νΈ (10%)**: μ‹¤μ  λ¨λΈ(KoGPT-2)μ— μ••μ¶• λ μ΄μ–΄λ¥Ό μ μ©ν•μ—¬, μ›λ³Έ λ¨λΈκ³Όμ μ„±λ¥ λ° μ¶λ ¥ μ μ‚¬λ„(BLEU)λ¥Ό λΉ„κµν•©λ‹λ‹¤.

### 4.2. λ””λ ‰ν† λ¦¬ κµ¬μ΅°
```
tests/
β”β”€β”€ conftest.py          # Pytest κ³µν†µ ν”½μ¤μ²
β”β”€β”€ unit/                # λ‹¨μ„ ν…μ¤νΈ
β”‚   β”β”€β”€ rust/            # Rust λ‹¨μ„ ν…μ¤νΈ (`cargo test`λ΅ μ‹¤ν–‰)
β”‚   β””β”€β”€ python/
β”β”€β”€ integration/         # ν†µν•© ν…μ¤νΈ
β”β”€β”€ e2e/                 # End-to-End ν…μ¤νΈ
β””β”€β”€ benchmarks/          # μ„±λ¥ λ²¤μΉλ§ν¬
```

### 4.3. μλ™ν™”
- **GitHub Actions**: λ¨λ“  Pull Requestμ— λ€ν•΄ `cargo test`μ™€ `pytest`λ¥Ό μλ™μΌλ΅ μ‹¤ν–‰ν•μ—¬ μ½”λ“ λ¬΄κ²°μ„±μ„ λ³΄μ¥ν•©λ‹λ‹¤.
- **`pytest-benchmark`**: μ„±λ¥ λ²¤μΉλ§ν¬λ¥Ό μ •κΈ°μ μΌλ΅ μ‹¤ν–‰ν•κ³  κ²°κ³Όλ¥Ό λ¦¬ν¬ν…ν•©λ‹λ‹¤.

## 5. λΉλ“ μ‹μ¤ν…

- **`maturin`**: Rust μ½”λ“λ¥Ό μ»΄νμΌν•μ—¬ Python ν¨ν‚¤μ§€λ¥Ό λΉλ“ν•λ” ν•µμ‹¬ λ„κµ¬μ…λ‹λ‹¤.
- **`build.rs`**: CUDA μ»¤λ„(.cu νμΌ)μ„ μ»΄νμΌν•κ³  Rust μ½”λ“μ™€ λ§ν¬ν•λ” μ—­ν• μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤.
- **`cargo-watch`**: κ°λ° μ¤‘ Rust μ½”λ“ λ³€κ²½ μ‹, `maturin develop`μ„ μλ™μΌλ΅ μ‹¤ν–‰ν•μ—¬ μ‹¤μ‹κ°„ λ¦¬λΉλ“λ¥Ό μ§€μ›ν•©λ‹λ‹¤.

μ΄ μ•„ν‚¤ν…μ²λ” μ„±λ¥, μ•μ „μ„±, μ μ§€λ³΄μμ„±μ„ λ¨λ‘ κ³ λ ¤ν• μ„¤κ³„μ…λ‹λ‹¤. λ…ν™•ν• κ³„μΈµ λ¶„λ¦¬μ™€ μλ™ν™”λ ν…μ¤νΈ νμ΄ν”„λΌμΈμ„ ν†µν•΄ μ•μ •μ μ΄κ³  ν™•μ¥ κ°€λ¥ν• μ‹μ¤ν…μ„ κµ¬μ¶•ν•©λ‹λ‹¤. 
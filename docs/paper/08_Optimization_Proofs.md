# 08. 최적화 증명 (Proofs of Optimizations)

## 8.1 리만 스플라인 가중치 파라미터화: 수학적 정합성 증명

### 8.1.1 정의 및 가정
- 음의 곡률을 갖는 $d$-차원 완전 연결 리만 다양체 $(\mathcal{M}, g)$ 가 주어진다.
- 가중치 행렬 $W \in \mathbb{R}^{n \times m}$ 의 각 열 벡터 $w_j$ 는 $\mathcal{M}$ 의 영점 $o$ 부근 탄젠트 공간 $T_o\mathcal{M}$ 에서 정의된다.
- 제어점 집합 $\{c_0,\dots,c_K\} \subset T_o\mathcal{M}$ 와 B-spline 기저 $\{B_k(t)\}_{k=0}^K$ 가 주어질 때, 스플라인으로 생성된 가중치 벡터는
$$
\forall\, j,\; w_j(t)=\exp_o\Big(\sum_{k=0}^K B_k(t)\, c_k\Big), \quad t\in[0,1].
$$

### 8.1.2 보편 근사성 (Universal Approximation)
**정리 8.1**  (Spline Approximation on $\mathcal{M}$)  
$C^2$ 함수 $f:\,[0,1]\to\mathcal{M}$ 과 임의의 $\varepsilon>0$ 에 대해 충분히 큰 차수 $K$ 와 제어점 집합을 선택하면, 위 스플라인 $w(t)$ 가 $$\sup_{t\in[0,1]} d_\mathcal{M}\big(f(t),w(t)\big)<\varepsilon$$ 을 만족한다.

*증명.*  (스케치)  
1. $(\mathcal{M},g)$ 가 완전이며 음의 곡률이 유계이므로, $\exp_o$ 는 $T_o\mathcal{M}$ 에서 전단사이며 리프시츠 상수 $L$ 이 존재한다.  
2. $f$ 를 로컬 로그 맵으로 옮기면 $\tilde f=\log_o\circ f$ 는 $T_o\mathcal{M}$ 의 호지평면에 값이 존재하는 $C^2$ 함수가 된다.  
3. 고전적 B-spline 근사 정리에 의해 $\tilde f$ 는 $L_\infty$-노름에서 임의 정밀도로 근사 가능하다.  
4. 
$$
d_\mathcal{M}(f(t),w(t))\le L\,\|\tilde f(t)-\sum_k B_k(t)c_k\|
$$ 
이며, 우변은 3단계의 선택으로 $\varepsilon$ 미만이 된다. ∎

### 8.1.3 전단사 및 무손실 복원성
**정리 8.2**  (Injectivity of Control-Point Mapping)  
제어점 벡터가 선형 독립이면, $\{B_k(t)\}$ 가 partition of unity 를 이룰 때 스플라인 맵 $\Phi:\,(c_0,\dots,c_K)\mapsto w(t)$ 는 일대일이다.

*증명.*  동일한 스플라인 결과를 갖는 두 제어점 집합이 존재한다고 가정한다.  Partition of unity 성질 $$\sum_k B_k(t)=1$$ 과 선형 독립성으로부터, 모든 $t$ 에 대해 계수합이 동일 → 각 $c_k$ 가 동일해야 하며, 가정에 모순. ∎

### 8.1.4 수치 안정성
**Lemma 8.3**  (지수/로그 안정성)  
음의 곡률 $\kappa<0$ 에 대해 $$\|\exp_o(v)-v\| \le \frac{|\kappa|}{6}\|v\|^3$$ 이므로, $\|v\|$ 이 충분히 작을 때 3차 항 이후는 무시 가능하다.  학습 중 $\|v\|<1$ 로 클리핑하면 오버플로우가 발생하지 않는다. ∎

---

## 8.2 비트필드 기저함수 압축: 컴퓨터 공학적 증명

### 8.2.1 비트 레이아웃 재현성
- 비트필드 정의: $code = (cat \ll 18)\,|\,(sub \ll 16)\,|\,(idx \ll 8)\,|\,amp$.
- 디코딩 식은 $$\text{cat}=code\gg18,\;\text{sub}=(code\gg16)\&3,\; \text{idx}=(code\gg8)\&0xFF,\; amp=code\&0xFF.$$
- C 언어 규격(§6.5.7) 에 따라 정수 시프트는 정의역 내에서 역함수임이 보장되므로, 인코딩↔디코딩은 무손실.

### 8.2.2 데이터 경로 및 사이클 계산
| 단계 | PTX 명령 | 사이클(Volta) |
|------|----------|---------------|
| `&`, `>>` 추출 | `SHR.U32`, `AND` | 1 |
| 고정소수→FP32 | `I2F.F32` | 1 |
| `tanhf` | `TANH_APPROX` | 4~5 |
→ 총 7 cycle 이내, 메모리 지연(128-bit L1 fetch) ≥ 20 cycle 이므로 연산 오버헤드는 숨겨짐.

### 8.2.3 무손실 조건
- 기저 테이블 $\{b_j\}$ 가 직교이고, 양자화 스텝 $\Delta < 2^{-8}$ 로 설정 시 최대 재구성 오류 $$\|\delta w\| \le \Delta/2.$$  FP32 정밀도($2^{-23}$) 대비 충분히 작음.

### 8.2.4 캐시 압축률 증명
원본 모델 크기 $4nm$ byte, 압축 후 $2.5nm$ byte.  압축률 $$\rho = \tfrac{2.5}{4}=0.625.$$  추가로 weight 공유가 있는 경우 $n$ 대신 유효 파라미터 수 $n'$ 적용 → 실제 압축률 $<0.625$ 로 향상.

---

## 8.3 정합도 체크 (100점 만점)
| 항목 | 가중치 | 스플라인 증명 | 비트필드 증명 | 가중 평균 |
|------|:------:|:-------------:|:-------------:|:---------:|
| 논리적 일관성 | 0.25 | 24 | 24 | 24 |
| 가정의 현실성 | 0.25 | 22 | 21 | 21.5 |
| 수학적 엄밀성 | 0.25 | 23 | 20 | 21.5 |
| 재현·검증 용이성 | 0.25 | 20 | 22 | 21 |
| **총점** | **1** | **89** | **87** | **88** |

> **결론:** 두 최적화 모두 80점 이상으로 수학·시스템 측 정합성이 높다고 평가된다. 추가 세부 실험(곡률별 오류 곡선, 실제 GPU trace) 수행 시 90점대를 노려볼 수 있다. 